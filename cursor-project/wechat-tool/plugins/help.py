"""
å¸®åŠ©æ’ä»¶
æä¾›ç³»ç»Ÿå¸®åŠ©å’Œå‘½ä»¤è¯´æ˜
"""

from typing import Dict, Any
from loguru import logger

from core.base_plugin import BasePlugin


class HelpPlugin(BasePlugin):
    """å¸®åŠ©æ’ä»¶"""
    
    def __init__(self, config_manager):
        super().__init__(config_manager)
        self.name = "Help"
        self.version = "1.0.0"
        self.description = "ç³»ç»Ÿå¸®åŠ©å’Œå‘½ä»¤è¯´æ˜"
    
    def start(self) -> None:
        """å¯åŠ¨æ’ä»¶"""
        self.is_running = True
        logger.info("å¸®åŠ©æ’ä»¶å·²å¯åŠ¨")
    
    def stop(self) -> None:
        """åœæ­¢æ’ä»¶"""
        self.is_running = False
        logger.info("å¸®åŠ©æ’ä»¶å·²åœæ­¢")
    
    def execute_command(self, command: str, **kwargs) -> str:
        """æ‰§è¡Œæ’ä»¶å‘½ä»¤"""
        if command == "help" or command == "":
            return self.get_main_help()
        elif command == "commands":
            return self.get_commands_help()
        elif command == "plugins":
            return self.get_plugins_help()
        elif command == "about":
            return self.get_about_info()
        else:
            return self.get_command_help(command)
    
    def get_help(self) -> str:
        """è·å–å¸®åŠ©ä¿¡æ¯"""
        return """
ğŸ“– å¸®åŠ©æ’ä»¶

ğŸ“‹ å¯ç”¨å‘½ä»¤ï¼š
â€¢ /help - æ˜¾ç¤ºä¸»å¸®åŠ©ä¿¡æ¯
â€¢ /help commands - æ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤
â€¢ /help plugins - æ˜¾ç¤ºæ’ä»¶ä¿¡æ¯
â€¢ /help about - æ˜¾ç¤ºå…³äºä¿¡æ¯
â€¢ /help [å‘½ä»¤å] - æ˜¾ç¤ºç‰¹å®šå‘½ä»¤å¸®åŠ©

ğŸ’¡ æç¤ºï¼š
â€¢ è¾“å…¥ 'help' æŸ¥çœ‹ä¸»å¸®åŠ©
â€¢ è¾“å…¥ 'commands' æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤
â€¢ è¾“å…¥ 'about' äº†è§£æœºå™¨äººä¿¡æ¯
        """
    
    def get_main_help(self) -> str:
        """è·å–ä¸»å¸®åŠ©ä¿¡æ¯"""
        return """
ğŸ¤– å¾®ä¿¡å·¥å…·æœºå™¨äºº - å¸®åŠ©ä¸­å¿ƒ

ğŸ¯ ä¸»è¦åŠŸèƒ½ï¼š
ğŸ“ æ–‡ä»¶è½¬æ¢ - Wordã€PDFã€å›¾ç‰‡äº’è½¬
â° å®šæ—¶ä»»åŠ¡ - å®šæ—¶å‘é€æ¶ˆæ¯å’Œæé†’
ğŸ“° æ–°é—»æ¨é€ - æ¯æ—¥é‡‘èæ–°é—»æ¨é€
ğŸ“– å¸®åŠ©ç³»ç»Ÿ - å®Œæ•´çš„å¸®åŠ©æ–‡æ¡£

ğŸ“‹ å¿«é€Ÿå¼€å§‹ï¼š
â€¢ å‘é€æ–‡ä»¶ â†’ è‡ªåŠ¨è½¬æ¢æ ¼å¼
â€¢ è¾“å…¥ 'help' â†’ æŸ¥çœ‹å¸®åŠ©
â€¢ è¾“å…¥ 'status' â†’ æŸ¥çœ‹çŠ¶æ€
â€¢ è¾“å…¥ 'plugins' â†’ æŸ¥çœ‹æ’ä»¶

ğŸ”§ ç³»ç»Ÿå‘½ä»¤ï¼š
â€¢ help/å¸®åŠ© - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
â€¢ status/çŠ¶æ€ - æŸ¥çœ‹æœºå™¨äººçŠ¶æ€
â€¢ plugins/æ’ä»¶ - æŸ¥çœ‹å·²å®‰è£…æ’ä»¶
â€¢ reload/é‡è½½ - é‡æ–°åŠ è½½æ’ä»¶

ğŸ’¡ ä½¿ç”¨æŠ€å·§ï¼š
â€¢ ç›´æ¥å‘é€æ–‡ä»¶å³å¯ä½¿ç”¨è½¬æ¢åŠŸèƒ½
â€¢ ä½¿ç”¨ /æ’ä»¶å help æŸ¥çœ‹æ’ä»¶å¸®åŠ©
â€¢ ä½¿ç”¨ /æ’ä»¶å status æŸ¥çœ‹æ’ä»¶çŠ¶æ€

ğŸ“ æŠ€æœ¯æ”¯æŒï¼š
å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ç®¡ç†å‘˜
        """
    
    def get_commands_help(self) -> str:
        """è·å–å‘½ä»¤å¸®åŠ©"""
        return """
ğŸ“‹ ç³»ç»Ÿå‘½ä»¤åˆ—è¡¨

ğŸ”§ åŸºç¡€å‘½ä»¤ï¼š
â€¢ help/å¸®åŠ© - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
â€¢ status/çŠ¶æ€ - æŸ¥çœ‹æœºå™¨äººçŠ¶æ€
â€¢ plugins/æ’ä»¶ - æŸ¥çœ‹å·²å®‰è£…æ’ä»¶
â€¢ reload/é‡è½½ - é‡æ–°åŠ è½½æ’ä»¶

ğŸ“ æ–‡ä»¶è½¬æ¢å‘½ä»¤ï¼š
â€¢ ç›´æ¥å‘é€æ–‡ä»¶ - è‡ªåŠ¨è½¬æ¢æ ¼å¼
â€¢ /file_converter help - æ–‡ä»¶è½¬æ¢å¸®åŠ©
â€¢ /file_converter status - è½¬æ¢çŠ¶æ€

â° å®šæ—¶ä»»åŠ¡å‘½ä»¤ï¼š
â€¢ /scheduler add daily 09:00 æ—©å®‰æé†’ - æ·»åŠ æ¯æ—¥æé†’
â€¢ /scheduler add weekly 1 18:00 å‘¨ä¼šæé†’ - æ·»åŠ æ¯å‘¨æé†’
â€¢ /scheduler add once 2024-01-01 10:00 æ–°å¹´å¿«ä¹ - æ·»åŠ ä¸€æ¬¡æ€§æé†’
â€¢ /scheduler list - æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
â€¢ /scheduler delete ä»»åŠ¡ID - åˆ é™¤ä»»åŠ¡
â€¢ /scheduler help - å®šæ—¶ä»»åŠ¡å¸®åŠ©

ğŸ“° æ–°é—»æ¨é€å‘½ä»¤ï¼š
â€¢ /news_pusher subscribe - è®¢é˜…æ–°é—»æ¨é€
â€¢ /news_pusher unsubscribe - å–æ¶ˆè®¢é˜…
â€¢ /news_pusher news - è·å–æœ€æ–°æ–°é—»
â€¢ /news_pusher help - æ–°é—»æ¨é€å¸®åŠ©

ğŸ’¡ å‘½ä»¤æ ¼å¼ï¼š
â€¢ /æ’ä»¶å å‘½ä»¤ [å‚æ•°]
â€¢ ä¾‹å¦‚: /scheduler add daily 09:00 æ—©å®‰æé†’
        """
    
    def get_plugins_help(self) -> str:
        """è·å–æ’ä»¶å¸®åŠ©"""
        return """
ğŸ“¦ å·²å®‰è£…æ’ä»¶

ğŸ“ FileConverter (æ–‡ä»¶è½¬æ¢æ’ä»¶)
â€¢ åŠŸèƒ½: Wordã€PDFã€å›¾ç‰‡æ ¼å¼è½¬æ¢
â€¢ å‘½ä»¤: /file_converter help
â€¢ çŠ¶æ€: è‡ªåŠ¨å¤„ç†æ–‡ä»¶ä¸Šä¼ 

â° Scheduler (å®šæ—¶ä»»åŠ¡æ’ä»¶)
â€¢ åŠŸèƒ½: å®šæ—¶å‘é€æ¶ˆæ¯å’Œæé†’
â€¢ å‘½ä»¤: /scheduler help
â€¢ çŠ¶æ€: æ”¯æŒæ¯æ—¥ã€æ¯å‘¨ã€ä¸€æ¬¡æ€§ä»»åŠ¡

ğŸ“° NewsPusher (æ–°é—»æ¨é€æ’ä»¶)
â€¢ åŠŸèƒ½: é‡‘èæ–°é—»æ¨é€
â€¢ å‘½ä»¤: /news_pusher help
â€¢ çŠ¶æ€: æ¯æ—¥è‡ªåŠ¨æ¨é€çƒ­é—¨æ–°é—»

ğŸ“– Help (å¸®åŠ©æ’ä»¶)
â€¢ åŠŸèƒ½: ç³»ç»Ÿå¸®åŠ©å’Œå‘½ä»¤è¯´æ˜
â€¢ å‘½ä»¤: /help
â€¢ çŠ¶æ€: æä¾›å®Œæ•´çš„å¸®åŠ©æ–‡æ¡£

ğŸ’¡ æ’ä»¶ä½¿ç”¨ï¼š
â€¢ æ¯ä¸ªæ’ä»¶éƒ½æœ‰ç‹¬ç«‹çš„å¸®åŠ©ç³»ç»Ÿ
â€¢ ä½¿ç”¨ /æ’ä»¶å help æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
â€¢ ä½¿ç”¨ /æ’ä»¶å status æŸ¥çœ‹æ’ä»¶çŠ¶æ€
        """
    
    def get_about_info(self) -> str:
        """è·å–å…³äºä¿¡æ¯"""
        return """
ğŸ¤– å…³äºå¾®ä¿¡å·¥å…·æœºå™¨äºº

ğŸ“ é¡¹ç›®ä¿¡æ¯ï¼š
â€¢ åç§°: å¾®ä¿¡å·¥å…·æœºå™¨äºº
â€¢ ç‰ˆæœ¬: 1.0.0
â€¢ å¼€å‘: AIåŠ©æ‰‹
â€¢ æ¶æ„: æ’ä»¶åŒ–è®¾è®¡

ğŸ¯ è®¾è®¡ç†å¿µï¼š
â€¢ æ¨¡å—åŒ–: åŠŸèƒ½ç‹¬ç«‹ï¼Œæ˜“äºæ‰©å±•
â€¢ ç”¨æˆ·å‹å¥½: ç®€å•æ˜“ç”¨çš„äº¤äº’æ–¹å¼
â€¢ é«˜å¯ç”¨: ç¨³å®šçš„è¿è¡Œå’Œé”™è¯¯å¤„ç†
â€¢ å¯æ‰©å±•: æ”¯æŒæ–°åŠŸèƒ½å¿«é€Ÿé›†æˆ

ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹ï¼š
â€¢ æ’ä»¶åŒ–æ¶æ„ - åŠŸèƒ½æ¨¡å—åŒ–ï¼Œæ˜“äºç»´æŠ¤
â€¢ é…ç½®åŒ–ç®¡ç† - æ”¯æŒçµæ´»é…ç½®
â€¢ æ•°æ®åº“å­˜å‚¨ - æ•°æ®æŒä¹…åŒ–
â€¢ å¤šçº¿ç¨‹å¤„ç† - å¹¶å‘å¤„ç†ä»»åŠ¡
â€¢ æ—¥å¿—è®°å½• - å®Œæ•´çš„æ“ä½œæ—¥å¿—

ğŸ“Š åŠŸèƒ½ç»Ÿè®¡ï¼š
â€¢ æ–‡ä»¶è½¬æ¢: æ”¯æŒ3ç§æ ¼å¼äº’è½¬
â€¢ å®šæ—¶ä»»åŠ¡: æ”¯æŒå¤šç§æ—¶é—´æ¨¡å¼
â€¢ æ–°é—»æ¨é€: å¤šæºæ–°é—»èšåˆ
â€¢ å¸®åŠ©ç³»ç»Ÿ: å®Œæ•´çš„æ–‡æ¡£æ”¯æŒ

ğŸ”„ æ›´æ–°è®¡åˆ’ï¼š
â€¢ æ›´å¤šæ–‡ä»¶æ ¼å¼æ”¯æŒ
â€¢ æ›´å¤šæ–°é—»æºæ¥å…¥
â€¢ æ›´å¤šå®šæ—¶ä»»åŠ¡ç±»å‹
â€¢ æ›´å¤šæ’ä»¶åŠŸèƒ½

ğŸ’¡ ä½¿ç”¨å»ºè®®ï¼š
â€¢ å®šæœŸæŸ¥çœ‹å¸®åŠ©æ–‡æ¡£
â€¢ åŠæ—¶åé¦ˆä½¿ç”¨é—®é¢˜
â€¢ å…³æ³¨åŠŸèƒ½æ›´æ–°é€šçŸ¥
        """
    
    def get_command_help(self, command: str) -> str:
        """è·å–ç‰¹å®šå‘½ä»¤å¸®åŠ©"""
        command_help = {
            "help": """
ğŸ“– help å‘½ä»¤å¸®åŠ©

ç”¨æ³•: help [å­å‘½ä»¤]

å­å‘½ä»¤:
â€¢ help - æ˜¾ç¤ºä¸»å¸®åŠ©ä¿¡æ¯
â€¢ commands - æ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤
â€¢ plugins - æ˜¾ç¤ºæ’ä»¶ä¿¡æ¯
â€¢ about - æ˜¾ç¤ºå…³äºä¿¡æ¯

ç¤ºä¾‹:
â€¢ help - æ˜¾ç¤ºä¸»å¸®åŠ©
â€¢ help commands - æ˜¾ç¤ºå‘½ä»¤åˆ—è¡¨
â€¢ help plugins - æ˜¾ç¤ºæ’ä»¶ä¿¡æ¯
            """,
            
            "status": """
ğŸ“Š status å‘½ä»¤å¸®åŠ©

ç”¨æ³•: status

åŠŸèƒ½: æŸ¥çœ‹æœºå™¨äººè¿è¡ŒçŠ¶æ€

æ˜¾ç¤ºä¿¡æ¯:
â€¢ æ’ä»¶è¿è¡ŒçŠ¶æ€
â€¢ ç³»ç»Ÿé…ç½®çŠ¶æ€
â€¢ æ•°æ®åº“è¿æ¥çŠ¶æ€
â€¢ å„æ’ä»¶ç»Ÿè®¡ä¿¡æ¯

ç¤ºä¾‹:
â€¢ status - æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
            """,
            
            "plugins": """
ğŸ“¦ plugins å‘½ä»¤å¸®åŠ©

ç”¨æ³•: plugins

åŠŸèƒ½: æŸ¥çœ‹å·²å®‰è£…æ’ä»¶

æ˜¾ç¤ºä¿¡æ¯:
â€¢ æ’ä»¶åˆ—è¡¨
â€¢ æ’ä»¶ç‰ˆæœ¬
â€¢ æ’ä»¶æè¿°
â€¢ è¿è¡ŒçŠ¶æ€

ç¤ºä¾‹:
â€¢ plugins - æŸ¥çœ‹æ’ä»¶åˆ—è¡¨
            """,
            
            "reload": """
ğŸ”„ reload å‘½ä»¤å¸®åŠ©

ç”¨æ³•: reload

åŠŸèƒ½: é‡æ–°åŠ è½½æ‰€æœ‰æ’ä»¶

æ³¨æ„äº‹é¡¹:
â€¢ ä¼šé‡æ–°åŠ è½½æ‰€æœ‰å¯ç”¨çš„æ’ä»¶
â€¢ æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ä¼šå—åˆ°å½±å“
â€¢ å»ºè®®åœ¨ç»´æŠ¤æ—¶ä½¿ç”¨

ç¤ºä¾‹:
â€¢ reload - é‡æ–°åŠ è½½æ’ä»¶
            """,
            
            "file_converter": """
ğŸ“ file_converter å‘½ä»¤å¸®åŠ©

ç”¨æ³•: /file_converter [å­å‘½ä»¤]

å­å‘½ä»¤:
â€¢ help - æ˜¾ç¤ºæ–‡ä»¶è½¬æ¢å¸®åŠ©
â€¢ status - æŸ¥çœ‹è½¬æ¢çŠ¶æ€

æ”¯æŒæ ¼å¼:
â€¢ Wordæ–‡æ¡£ (.doc/.docx) â†’ PDF
â€¢ å›¾ç‰‡æ–‡ä»¶ (.jpg/.pngç­‰) â†’ PDF
â€¢ PDFæ–‡ä»¶ â†’ Wordæ–‡æ¡£

ä½¿ç”¨æ–¹æ³•:
â€¢ ç›´æ¥å‘é€æ–‡ä»¶å³å¯è‡ªåŠ¨è½¬æ¢
â€¢ è½¬æ¢åçš„æ–‡ä»¶ä¼šè‡ªåŠ¨å‘é€ç»™æ‚¨

ç¤ºä¾‹:
â€¢ /file_converter help - æŸ¥çœ‹å¸®åŠ©
â€¢ /file_converter status - æŸ¥çœ‹çŠ¶æ€
            """,
            
            "scheduler": """
â° scheduler å‘½ä»¤å¸®åŠ©

ç”¨æ³•: /scheduler [å­å‘½ä»¤] [å‚æ•°]

å­å‘½ä»¤:
â€¢ add - æ·»åŠ å®šæ—¶ä»»åŠ¡
â€¢ list - æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
â€¢ delete - åˆ é™¤æŒ‡å®šä»»åŠ¡
â€¢ help - æ˜¾ç¤ºå¸®åŠ©
â€¢ status - æŸ¥çœ‹çŠ¶æ€

æ—¶é—´æ ¼å¼:
â€¢ daily HH:MM - æ¯æ—¥æ‰§è¡Œ
â€¢ weekly 0-6 HH:MM - æ¯å‘¨æŒ‡å®šå¤©æ‰§è¡Œ
â€¢ once YYYY-MM-DD HH:MM - ä¸€æ¬¡æ€§æ‰§è¡Œ

ç¤ºä¾‹:
â€¢ /scheduler add daily 09:00 æ—©å®‰æé†’
â€¢ /scheduler add weekly 1 18:00 å‘¨ä¼šæé†’
â€¢ /scheduler add once 2024-01-01 10:00 æ–°å¹´å¿«ä¹
â€¢ /scheduler list - æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
â€¢ /scheduler delete 1 - åˆ é™¤ä»»åŠ¡IDä¸º1çš„ä»»åŠ¡
            """,
            
            "news_pusher": """
ğŸ“° news_pusher å‘½ä»¤å¸®åŠ©

ç”¨æ³•: /news_pusher [å­å‘½ä»¤]

å­å‘½ä»¤:
â€¢ subscribe - è®¢é˜…æ–°é—»æ¨é€
â€¢ unsubscribe - å–æ¶ˆè®¢é˜…
â€¢ news - è·å–æœ€æ–°æ–°é—»
â€¢ help - æ˜¾ç¤ºå¸®åŠ©
â€¢ status - æŸ¥çœ‹çŠ¶æ€

åŠŸèƒ½è¯´æ˜:
â€¢ æ¯æ—¥è‡ªåŠ¨æ¨é€é‡‘èæ–°é—»
â€¢ æ”¯æŒæ‰‹åŠ¨è·å–æœ€æ–°æ–°é—»
â€¢ å¤šæºæ–°é—»èšåˆ

ç¤ºä¾‹:
â€¢ /news_pusher subscribe - è®¢é˜…æ–°é—»
â€¢ /news_pusher unsubscribe - å–æ¶ˆè®¢é˜…
â€¢ /news_pusher news - è·å–æœ€æ–°æ–°é—»
â€¢ /news_pusher status - æŸ¥çœ‹çŠ¶æ€
            """
        }
        
        return command_help.get(command, f"æœªæ‰¾åˆ°å‘½ä»¤ '{command}' çš„å¸®åŠ©ä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ 'help' æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤ã€‚") 